(()=>{function w(d,t){let e=document.createElement("style");e.id=d,e.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(e)}function x(d,t){d.forEach(e=>{let o=document.createElement("script");o.src=e,o.async=!0,o.onload=t,document.getElementsByTagName("head")[0].appendChild(o)})}function tt(d){d.forEach(t=>{let e=document.getElementsByTagName("head")[0],o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href=t,o.media="all",e.appendChild(o)})}function C(d){d.forEach(t=>{let e=document.createElement("link");e.id=`outpost-pub-font-${t}`,e.rel="stylesheet",e.type="text/css",e.href=`https://fonts.googleapis.com/css?family=${encodeURI(t)}`,document.getElementsByTagName("head")[0].appendChild(e)})}function T(d){document.body.insertAdjacentHTML("beforeend",d)}function et(d){let t=document.createElement("script");t.textContent=d,document.body.appendChild(t)}function O(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function E(){return window.location.pathname==="/"}function S(d){let t=d.post;return t&&t.id}function vt(){return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var t=Math.random()*16|0,e=d=="x"?t:t&3|8;return e.toString(16)})}function st(){return window.localStorage.guid!=null||(window.localStorage.guid=vt()),window.localStorage.guid}function ot(){return document.querySelectorAll("[outpost-download-pdf]").length>0}function M(){return document.querySelectorAll(".outpost-contact-form").length>0}function L(){return document.querySelectorAll(".outpost-address-form").length>0}var f={HOMEPAGE_POPUP_OFFER:"homepage-offer-popup",HOMEPAGE_POPUP_SUBSCRIBE:"homepage-subscribe-popup",POST_POPUP_SUBSCRIBE:"classic-popup-box",POST_POPUP_DISCOUNT:"classic-popup-box-discount",POST_POPUP_UPGRADE:"classic-popup-box-upgrade",POST_POPUP_LINK:"classic-popup-box-link",POST_POPUP_NO_BUTTON:"classic-popup-no-button",POST_POPUP_WIDE_MODERN:"wide-modern-popup",PAYWALL_SUBSCRIBE:"paywall-subscribe-popup",PAYWALL_UPGRADE:"paywall-upgrade-popup"},A=[f.HOMEPAGE_POPUP_OFFER,f.HOMEPAGE_POPUP_SUBSCRIBE],at=[f.HOMEPAGE_POPUP_OFFER,f.HOMEPAGE_POPUP_SUBSCRIBE,f.POST_POPUP_SUBSCRIBE,f.POST_POPUP_DISCOUNT,f.POST_POPUP_UPGRADE,f.POST_POPUP_LINK,f.POST_POPUP_NO_BUTTON,f.POST_POPUP_WIDE_MODERN,f.PAYWALL_SUBSCRIBE,f.PAYWALL_UPGRADE];var D=class{constructor(t,e,o,s){this.options=t,this.site=e,this.data=o,this.member=s}loadAssets(t,e){e.css&&w(`outpost-box${t}-style`,e.css),e.fonts&&C(e.fonts),e.body&&T(e.body),e.script&&et(e.script)}attachSubscriptionFormEvents(){Array.from(document.querySelectorAll("form[data-outpost-members-form]")).forEach(t=>{let e=t.querySelector("[data-members-error]"),o=this.site,s=a=>this.outpostGhostSubscribeBoxHandler({event:a,errorEl:e,form:t,site:o,submitHandler:s});t.getAttribute("listener-added")||(t.addEventListener("submit",s),t.setAttribute("listener-added",!0))})}outpostGhostSubscribeBoxHandler({event:t,form:e,errorEl:o,site:s,submitHandler:a}){e.removeEventListener("submit",a),t.preventDefault(),this.resetFormClasses(e,o);let i=t.target.querySelector("input[data-members-email]"),c=t.target.querySelector("input[data-members-name]"),p=i?.value,m=c?.value,l=Array.from(t.target.querySelectorAll("input[data-members-label]")||[]).map(n=>n.value);e.classList.add("loading"),this.submitSubscribeForm({email:p,labels:l,name:m,form:e,errorEl:o,site:s,submitHandler:a})}resetFormClasses(t,e){e&&(e.innerText=""),t.classList.remove("success","invalid","error")}submitSubscribeForm({email:t,labels:e,name:o,form:s,errorEl:a,site:i,submitHandler:c}){let p={email:t,labels:e,name:o};fetch(`${i.url}/members/api/integrity-token/`,{method:"GET"}).then(m=>m.text()).then(m=>{fetch(`${i.url}members/api/send-magic-link/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...p,integrityToken:m})}).then(l=>{if(s.addEventListener("submit",c),s.classList.remove("loading"),l.ok&&s.classList.add("success"),this.data.settings){let n=this.data.settings;if(n.onSubmit&&n.onSubmit.hideForm){let r=s.parentNode,u=r.querySelector(".outpost-cta-heading"),h=r.querySelector(".outpost-cta-signin");u.innerHTML='<img src="https://assets.outpostpublishingcoop.com/assets/img/cta/check-mark.png" class="thank-you-img" width="28" height="28" />'+n.onSubmit.headerText,u.classList.add("thank-you"),r.querySelector(".outpost-cta-subheading").innerHTML=n.confirmationText,s.style.display="none",h&&(h.style.display="none")}}}).catch(l=>{a&&(a.innerText="There was an error sending the email, please try again"),s.classList.add("error")})})}filterParagraphs(t,e){return t.filter(o=>!e.some(s=>o.closest(s)))}getPostContentItems(t){let e="main article:first-of-type";document.querySelectorAll(".gh-content").length&&(e=".gh-content");let o=t.autoplacement&&t.autoplacement.content||e,s=document.querySelectorAll(o),a=t.autoplacement&&t.autoplacement.selector||"p",i=Array.from(s[0]?.querySelectorAll(a)||[]);i.length&&(i=Array.from(i[0].parentNode.querySelectorAll(":scope > *")||[]));let c=[".content-cta",".outpost-pub-container",".ctx-module-container"];return this.filterParagraphs(i,c)}isCtaAllowed(t){if(S(this.options)){let e=this.options.post;return!e.tags||!e.tags.includes("#hide-outpost-cta")}else if(E())return A.includes(t.type);return!1}setupViewObserver(t,e){let o=!1,s=new IntersectionObserver(a=>{a.forEach(i=>{i.isIntersecting&&!o&&(o=!0,s.unobserve(i.target),e())})});s.observe(t)}setupClickEvent(t,e){t.addEventListener("click",e)}logPlausibleEvent(t){typeof plausible>"u"||plausible(t)}},g=D;var U=class extends g{render(){this.renderManualButtons(),this.data&&this.renderCTAButtons(this.data)}renderManualButtons(){let t=this.options;t.memberId&&t.memberPaid==="true"&&t.memberPlans.length&&(this.outpostCheckDonationButtons("data-btn-donation-paidmembers"),this.outpostShowForPaidMembersButtons()),this.outpostCheckDonationButtons("data-btn-donation-all"),this.renderManualTierButton()}renderCTAButtons(t){Object.keys(t).forEach(e=>{let o=t[e];o.url&&document.querySelectorAll(`[data-btn-${e}]`).forEach(s=>{s.innerHTML="";let a=document.createElement("div");a.className="text-center";let i=this.createCTAButton(o);a.appendChild(i),s.appendChild(a)})})}createCTAButton(t){let e=t.target||"",o=t.class||"btn btn-primary",s=document.createElement("a");return s.className=o,s.setAttribute("target",e),s.setAttribute("href",t.url),s.innerHTML=t.text,s.style.visibility="visible",s}outpostCheckDonationButtons(t){let e=this.options,o=`${e.apiDomain}/ghost-integration/${e.apiKey}/tips/${e.memberId}`,s=a=>a.getAttribute("data-btn-text")||"Tip Jar";document.querySelectorAll(`[${t}]`).forEach(a=>{a.innerHTML="";let i=document.createElement("div");i.className="text-center";let c=this.outpostCreateDonationButton({url:o,text:s(a)});i.appendChild(c),a.appendChild(i)})}outpostShowForPaidMembersButtons(){document.querySelectorAll(".visible-paid-only").forEach(t=>{t.style.visibility="visible",t.style.display="block"})}outpostCreateDonationButton(t){let e=this.getDefaultMemberText(),o=t.text||e,s=t.target||"",a=t.class||"btn btn-primary",i=t.url||"",c=document.createElement("a");return c.className=a,c.setAttribute("target",s),c.setAttribute("href",i),c.innerHTML=o,c.style.visibility="visible",c}getDefaultMemberText(){let t=this.options,e=`Subscribe To ${t.siteName}`;return t.memberId&&(e=t.memberPaid?"Become a Supporter":"Become A Paid Subscriber For Full Access"),e}renderManualTierButton(){let t=this.member;t||(t={tier_id:"unknown"}),document.querySelectorAll("[data-btn-tier]").forEach(e=>{let o=e.querySelector("a");o&&t&&JSON.parse(decodeURIComponent(o.getAttribute("data-tier-settings"))).forEach(a=>{if(a.tierId===t.tier_id){e.style.visibility="visible",e.style.display="block",o.setAttribute("href",a.url);let i=a.label;i=i.replaceAll("{TIER_NAME}",a.tierName),o.innerText=i}})})}},it=U;var nt=(()=>{"use strict";let d=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'];class t{constructor({targetModal:n,triggers:r=[],onShow:u=()=>{},onClose:h=()=>{},openTrigger:P="data-micromodal-trigger",closeTrigger:v="data-micromodal-close",openClass:q="is-open",disableScroll:B=!1,disableFocus:N=!1,awaitCloseAnimation:k=!1,awaitOpenAnimation:F=!1,debugMode:R=!1,disableEsc:$=!1}){this.modal=document.getElementById(n),this.config={debugMode:R,disableScroll:B,openTrigger:P,closeTrigger:v,openClass:q,onShow:u,onClose:h,awaitCloseAnimation:k,awaitOpenAnimation:F,disableFocus:N,disableEsc:$},r.length>0&&this.registerTriggers(...r),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}registerTriggers(...n){n.filter(Boolean).forEach(r=>{r.addEventListener("click",u=>this.showModal(u))})}showModal(n=null){if(this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add(this.config.openClass),this.scrollBehaviour("disable"),this.addEventListeners(),this.config.awaitOpenAnimation){let r=()=>{this.modal.removeEventListener("animationend",r,!1),this.setFocusToFirstNode()};this.modal.addEventListener("animationend",r,!1)}else this.setFocusToFirstNode();this.config.onShow(this.modal,this.activeElement,n)}closeModal(n=null){let r=this.modal;if(this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.scrollBehaviour("enable"),this.config.onClose(this.modal,this.activeElement,n),this.config.awaitCloseAnimation){let u=this.config.openClass;this.modal.addEventListener("animationend",function h(){r.classList.remove(u),r.removeEventListener("animationend",h,!1)},!1)}else r.classList.remove(this.config.openClass)}closeModalById(n){this.modal=document.getElementById(n),this.modal&&this.closeModal()}scrollBehaviour(n){if(!this.config.disableScroll)return;let r=document.querySelector("body");switch(n){case"enable":Object.assign(r.style,{overflow:""});break;case"disable":Object.assign(r.style,{overflow:"hidden"});break;default:}}addEventListeners(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}removeEventListeners(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}onClick(n){(n.target.hasAttribute(this.config.closeTrigger)||n.target.parentNode.hasAttribute(this.config.closeTrigger))&&(n.preventDefault(),n.stopPropagation(),this.closeModal(n))}onKeydown(n){n.keyCode===27&&!this.config.disableEsc&&this.closeModal(n),n.keyCode===9&&this.retainFocus(n)}getFocusableNodes(){let n=this.modal.querySelectorAll(d);return Array(...n)}setFocusToFirstNode(){if(this.config.disableFocus)return;let n=this.getFocusableNodes();if(n.length===0)return;let r=n.filter(u=>!u.hasAttribute(this.config.closeTrigger));r.length>0&&r[0].focus(),r.length===0&&n[0].focus()}retainFocus(n){let r=this.getFocusableNodes();if(r.length!==0)if(r=r.filter(u=>u.offsetParent!==null),!this.modal.contains(document.activeElement))r[0].focus();else{let u=r.indexOf(document.activeElement);n.shiftKey&&u===0&&(r[r.length-1].focus(),n.preventDefault()),!n.shiftKey&&r.length>0&&u===r.length-1&&(r[0].focus(),n.preventDefault())}}}let e={},o=(l,n)=>{let r=[];return l.forEach(u=>{let h=u.attributes[n].value;r[h]===void 0&&(r[h]=[]),r[h].push(u)}),r},s=l=>{if(!document.getElementById(l))return console.warn(`MicroModal: \u2757Seems like you have missed %c'${l}'`,"background-color: #f8f9fa;color: #50596c;font-weight: bold;","ID somewhere in your code. Refer example below to resolve it."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",`<div class="modal" id="${l}"></div>`),!1},a=l=>{if(l.length<=0)return console.warn("MicroModal: \u2757Please specify at least one %c'micromodal-trigger'","background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>'),!1},i=(l,n)=>{if(a(l),!n)return!0;for(let r in n)s(r);return!0};return{init:l=>{let n=Object.assign({},{openTrigger:"data-micromodal-trigger"},l),r=[...document.querySelectorAll(`[${n.openTrigger}]`)],u=o(r,n.openTrigger);if(!(n.debugMode===!0&&i(r,u)===!1))for(let h in u){let P=u[h];n.targetModal=h,n.triggers=[...P],e[h]=new t(n)}},show:(l,n)=>{let r=n||{};r.targetModal=l,!(r.debugMode===!0&&s(l)===!1)&&(e[l]&&e[l].removeEventListeners(),e[l]=new t(r),e[l].showModal())},close:l=>{if(l)e[l].closeModalById(l);else for(let n in e)e[n].closeModal()}}})(),b=nt;typeof window<"u"&&(window.MicroModal=nt);var H=class extends g{constructor(t,e,o){super(t,e,o),this.scrollDeepEvents={},this.hideModals=!1}#t(t){if(S(this.options)){let e=this.options.post;return!e.tags||!e.tags.includes("#hide-outpost-cta")}else if(E())return A.includes(t.type);return!1}#e(t,e){A.includes(e.type)&&this.#i(e)&&this.#s(t,e)}#s(t,e){this.loadAssets(t,e),this.#o(e)}#o(t){switch(t.autoplacement.mode||(t.autoplacement.mode="manual"),t.autoplacement.mode){case"start":case"end":case"manual":let e=`outpost-${t.className}-${t.guid}`;this.#d(`#${e}-anchor`,()=>this.#a(t));break;case"page_load":this.#a(t);break;case"delay":setTimeout(()=>this.#a(t),t.autoplacement.delaySeconds*1e3);break;case"scroll":this.#n(t);break}}#n(t){t.autoplacement&&t.autoplacement.scrollPercents&&(this.scrollDeepEvents[t.guid]=()=>{let e=document.body,s=window.scrollY/(e.scrollHeight-window.innerHeight)*100;s=Math.round(s),s>=t.autoplacement.scrollPercents&&(this.#a(t),window.removeEventListener("scroll",this.scrollDeepEvents[t.guid]))},window.addEventListener("scroll",this.scrollDeepEvents[t.guid]))}#i(t){let e=+localStorage.getItem(`closedModal-${t.guid}`);return e&&t.settings?.displayHours?(Date.now()-e)/1e3>t.settings.displayHours*3600:!0}#a(t){let e=`outpost-${t.className}-${t.guid}`,o=this.#r(t);document.activeElement.blur(),b.show(e,o)}#r(t){let e={onClose:o=>this.#l(`${t.guid}`)};return at.includes(t.type)&&(e.disableScroll=!0),O()&&(e.disableFocus=!0),e}#l(t){localStorage.setItem(`closedModal-${t}`,Date.now())}#c(t,e){let o=`[data-box-${t}]`;document.querySelectorAll(o).length||this.#u(t,e),document.querySelectorAll(o).forEach(s=>{s.innerHTML=e.html,s.style.visibility="visible"}),this.loadAssets(t,e),e.jss&&!this.hideModals&&this.#i(e)&&this.#o(e)}#d(t,e){let o=document.querySelector(t);if(!o)return;let s=!1,a=new IntersectionObserver(i=>{i.forEach(c=>{c.isIntersecting&&!s&&(s=!0,a.unobserve(c.target),e())})});a.observe(o)}#u(t,e){let o=[".content-cta",".ctx-module-container",".gh-post-upgrade-cta",".outpost-pub-container"],s=e.autoplacement,a="main article:first-of-type",i=document.createElement("div");i.className=`outpost-pub-container outpost-${e.className}`,i.setAttribute("data-box-"+t,""),document.querySelectorAll(".gh-content").length&&(a=".gh-content");let c=e.autoplacement.content||a,p=document.querySelectorAll(c),m=e.autoplacement.selector||"p",l=e.autoplacement.minParagraphs||3;l<3&&(l=3);let n=Array.from(p[0]?.querySelectorAll(m)||[]),r=this.#p(n,o);Array.from(p[0]?.querySelectorAll("p")||[]).length<l||r.length<l||this.#m(s,r,i)}#p(t,e){return t.filter(o=>!e.some(s=>o.closest(s)))}#m(t,e,o){t.direction==="start"?t.paragraph=Math.min(t.paragraph,e.length):t.paragraph=Math.max(t.paragraph,e.length+1-t.paragraph),e.forEach((s,a)=>{(t.after==="after"&&t.paragraph===a+1||t.after!=="after"&&t.paragraph===a+1)&&(t.after==="after"?s.parentNode.insertBefore(o,s.nextSibling):s.parentNode.insertBefore(o,s))})}disablePopups(){this.hideModals=!0}render(){Object.keys(this.data).forEach(t=>{let e=this.data[t];e.html&&this.#t(e)&&(E()?this.#e(t,e):S(this.options)&&this.#c(t,e))}),this.attachSubscriptionFormEvents()}},I=H;var j=class{constructor(t){this.options=t}#t(){let t=this.options,e={post:{...t.post,url:window.location.href},device:O()};return t.memberId?e.member={id:t.memberId}:e.session={guid:st()},e}#e(){let e=["/membership/","/welcome-to-tangle/"].includes(window.location.pathname),o=typeof window.allowOutpostApi<"u";return!!(S(this.options)||E())||e||ot()||M()||o||L}#s(){let t=this.options;return t.apiKey&&t.apiDomain}#o(t){let e=this.options.apiDomain.replace(/\/$/,"");if(t===""){if(e.includes(".devoutpost.xyz"))return"https://cta.devoutpost.xyz";if(e.includes(".outpost.pub"))return"https://cta.outpost.pub"}return e}request(t,e,o,s){if(!this.#s()){console.log("Outpost API key or Domain name is missing.");return}if(!this.#e()){console.log("Outpost API is not allowed on this page.");return}let a=this.#t(),i=Object.assign(e,a),c={method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}},m=`${this.#o(t)}/plugin-api${t}/${this.options.apiKey}/${this.options.memberId}`;fetch(m,c).then(l=>l.json()).then(l=>o(l)).catch(l=>{console.log("[OUTPOST API ERROR]",l),s&&s()})}},y=j;var G=class extends g{constructor(t,e){super(t,e,{}),this.options=t}#t(t,e){if(t.url)window.open(t.url);else if(t.sent){let o=t.dialog;this.loadAssets(o.id,o),b.show(o.id)}else Object.keys(t.popups).forEach(o=>{let s=t.popups[o];this.loadAssets(o,s);let a=`outpost-${s.className}-${s.guid}`;document.activeElement.blur(),b.show(a)}),this.attachSubscriptionFormEvents()}render(){document.querySelectorAll("[outpost-download-pdf]").forEach(t=>{t.setAttribute("href","javascript:void(0);");let e=t.getAttribute("outpost-download-pdf");t.addEventListener("click",()=>(new y(this.options).request("/pdf-download",{pdf:{guid:e}},s=>{this.#t(s,t)}),!1))})}},rt=G;var K=class extends I{#t(t,e){let o=`outpost-${t}-${e.guid}`,s={disableScroll:!0,disableFocus:!0,disableEsc:!0};document.activeElement.blur(),b.show(o,s)}#e(t,e){let s=this.getPostContentItems(e);if(s.length<3)return;let a=document.createElement("div");a.className=`outpost-pub-container outpost-${e.className}`,a.setAttribute("data-box-"+t,""),a.style.visibility="visible",a.innerHTML=e.html,s.forEach((i,c)=>{c===3?(i.parentNode.classList.add("outpost-cta-content-fading"),i.parentNode.parentNode.append(a)):c>3&&i.remove()})}render(){let t=this.data,e=t.type;this.loadAssets(e,t),e.includes("-popup")?this.#t(e,t):this.#e(e,t),this.attachSubscriptionFormEvents()}},lt=K;var V=class extends g{constructor(t,e,o){super(t,e,{},o)}#t(t,e){let o=e.querySelector("input[data-contact-email]"),s=e.querySelector("input[data-contact-name]");o&&(o.value=this.member?this.member.email:this.options.memberEmail,o.value&&(o.readOnly=!0,t.classList.add("logged"))),s&&(s.value=this.member?this.member.name:"")}#e(t){let e=t.querySelector("textarea[data-contact-message]"),o=t.querySelector(".outpost-progress-bar"),s=t.querySelector(".outpost-remaining-chars");function a(i){let c=i.getAttribute("maxlength"),p=i.value.length,m=p/c*100;o.style.width=`${m}%`,s.style.display="none",m<=60?o.style.backgroundColor="rgb(19, 160, 19)":m>60&&m<85?o.style.backgroundColor="rgb(236, 157, 8)":(o.style.backgroundColor="rgb(241, 9, 9)",s.innerHTML=`${c-p} characters left`,s.style.display="block")}e.oninput=()=>a(e)}render(){Array.from(document.querySelectorAll(".outpost-contact")).forEach(t=>{let e=t.querySelector("form[data-outpost-contact-form]"),o=e.querySelector(".outpost-message-error"),s=this.site;this.#t(t,e),this.#e(e);let a=i=>this.outpostContactFormSubmitHandler({event:i,errorEl:o,form:e,site:s,submitContactFormHandler:a});e.addEventListener("submit",a)})}outpostContactFormSubmitHandler({event:t,form:e,errorEl:o,site:s,submitHandler:a}){let i=t.target.querySelector("input[data-contact-email]"),c=t.target.querySelector("input[data-contact-name]"),p=t.target.querySelector("select[data-contact-subject]"),m=t.target.querySelector("textarea[data-contact-message]"),l=i?.value,n=c?.value,r=p?.value,u=m?.value;e.removeEventListener("submit",a),t.preventDefault(),this.resetFormClasses(e,o),e.classList.add("loading"),this.submitContactForm({email:l,name:n,subject:r,message:u,form:e,errorEl:o,site:s,submitHandler:a})}submitContactForm({email:t,name:e,subject:o,message:s,form:a,errorEl:i,site:c,submitHandler:p}){let m={email:t,name:e,subject:o,message:s};new y(this.options).request("/contact-form",m,n=>{a.addEventListener("submit",p),a.classList.remove("loading"),n.success&&a.classList.add("success")},()=>{i&&(i.innerText="There was an error sending the email, please try again"),a.classList.remove("loading"),a.classList.add("error")})}},ct=V;var W=class extends g{#t;constructor(t,e,o){super(t,e,{},o)}#e(t,e){let o=e.querySelector("input[data-contact-email]"),s=e.querySelector("input[data-contact-first-name]"),a=e.querySelector("input[data-contact-last-name]"),i=e.querySelector("input[data-contact-id]");if(i.value=this.member?this.member.ghost_guid:this.options.memberId,o&&(o.value=this.member?this.member.email:this.options.memberEmail,o.value&&(o.readOnly=!0,t.classList.add("logged"))),s){let c=this.member?this.member.name:"",p=c.split(" ");p.length>1?(s.value=p[0],p.shift(),a.value=p.join(" ")):s.value=c}}#s(t){if(typeof google<"u"){let e=t.querySelector("input[data-contact-address1]");this.#t=new google.maps.places.Autocomplete(e,{componentRestrictions:{country:["de"]},fields:["address_components","geometry"],types:["address"]}),this.#t.addListener("place_changed",()=>{let o=this.#t.getPlace(),s={line1:["","",""],city:"",country:"",postcode:""};o.address_components.forEach(a=>{a.types.forEach(i=>{i==="subpremise"&&(s.line1[0]=a.long_name),i==="street_number"&&(s.line1[1]=a.long_name),i==="route"&&(s.line1[2]=a.long_name),["locality"].includes(i)&&(s.city=a.long_name),i==="country"&&(s.country=a.long_name),["postal_code","postal_code_prefix"].includes(i)&&(s.postcode=a.long_name)})}),t.querySelector("input[data-contact-city]").value=s.city,t.querySelector("input[data-contact-zip]").value=s.postcode,t.querySelector("input[data-contact-address1]").value=s.line1.join(" ").trim()})}}render(){let t=this.options;t.memberId&&t.memberPaid==="true"&&Array.from(document.querySelectorAll(".outpost-address")).forEach(o=>{let s=o.querySelector("form[data-outpost-address-form]"),a=s.querySelector(".outpost-message-error"),i=this.site;this.#e(o,s),this.#s(s);let c=p=>this.outpostAddressFormSubmitHandler({event:p,errorEl:a,form:s,site:i,submitFormHandler:c});s.addEventListener("submit",c)})}outpostAddressFormSubmitHandler({event:t,form:e,errorEl:o,site:s,submitHandler:a}){let i=t.target.querySelector("input[data-contact-email]"),c=t.target.querySelector("input[data-contact-first-name]"),p=t.target.querySelector("input[data-contact-last-name]"),m=t.target.querySelector("select[data-contact-country]"),l=t.target.querySelector("input[data-contact-city]"),n=t.target.querySelector("input[data-contact-zip]"),r=t.target.querySelector("input[data-contact-address1]"),u=t.target.querySelector("input[data-contact-address2]"),h=t.target.querySelector("input[data-contact-company]"),P=t.target.querySelector("input[data-contact-id]"),v=[];c?.value&&v.push(c.value),p?.value&&v.push(p.value);let q=i?.value,B=v.join(" "),N=m?.value,k=l?.value,F=n?.value,R=r?.value,$=u?.value,bt=h?.value,yt=P?.value;e.removeEventListener("submit",a),t.preventDefault(),this.resetFormClasses(e,o),e.classList.add("loading"),this.submitAddressForm({email:q,name:B,address1:R,address2:$,company:bt,zip:F,city:k,country:N,guid:yt,form:e,errorEl:o,site:s,submitHandler:a})}submitAddressForm({email:t,name:e,address1:o,address2:s,company:a,zip:i,city:c,country:p,guid:m,form:l,errorEl:n,site:r,submitHandler:u}){let h={email:t,name:e,address1:o,address2:s,company:a,zip:i,city:c,country:p,guid:m};new y(this.options).request("/address-form",h,v=>{l.addEventListener("submit",u),l.classList.remove("loading"),v.success&&l.classList.add("success"),window.scrollTo(0,0)},()=>{n&&(n.innerText="There was an error in form submitting, please try again"),l.classList.remove("loading"),l.classList.add("error"),window.scrollTo(0,0)})}},dt=W;var J=class extends g{constructor(t,e,o){super(t,e,o)}#t(t,e){let o=e.autoplacement.minParagraphs||3,s=this.getPostContentItems(e),a=e.autoplacement;if(s.length<o)return;let i=document.createElement("div");i.className="outpost-pub-container",i.setAttribute(t,""),this.#e(a,s,i),this.#s(a,i)}#e(t,e,o){let s=parseInt(t.paragraph||t.value);t.direction==="start"?t.paragraph=Math.min(s,e.length):t.paragraph=Math.max(s,e.length+1-s),e.forEach((a,i)=>{(t.after==="after"&&s===i+1||t.after!=="after"&&s===i+1)&&(t.after==="after"?a.parentNode.insertBefore(o,a.nextSibling):a.parentNode.insertBefore(o,a))})}#s(t,e){this.setupViewObserver(e,()=>this.viewEventAction(t)),this.setupClickEvent(e,()=>this.clickEventAction(t))}viewEventAction(t){t.plausibleViewEventName&&this.logPlausibleEvent(t.plausibleViewEventName)}clickEventAction(t){t.plausibleClickEventName&&this.logPlausibleEvent(t.plausibleClickEventName)}render(){Object.keys(this.data).forEach(t=>{let e=this.data[t];if(e.html&&this.isCtaAllowed(e)){let o=`data-${t}`,s=`[${o}]`;document.querySelectorAll(s).length||this.#t(o,e),document.querySelectorAll(s).forEach(a=>{a.innerHTML=e.html,a.style.visibility="visible"}),this.loadAssets(t,e)}})}},ut=J;var z=class{constructor(t,e){this.options=t,this.data=e}render(){if(this.data.css&&w("outpost-pub-style",this.data.css),this.data.fonts&&C(this.data.fonts),new it(this.options,this.data.site,this.data.buttons,this.data.member).render(),this.data.paywall&&new lt(this.options,this.data.site,this.data.paywall).render(),this.data.boxes){let o=new I(this.options,this.data.site,this.data.boxes);this.data.paywall&&o.disablePopups(),o.render()}this.data.adCampaigns&&new ut(this.options,this.data.site,this.data.adCampaigns).render(),new rt(this.options,this.data.site).render(),M()&&new ct(this.options,this.data.site,this.data.member).render(),L()&&new dt(this.options,this.data.site,this.data.member).render()}},pt=z;var Y=class{constructor(t,e,o){this.options=t,this.params=e,this.site=o}},_=Y;var Q=class extends _{init(){let t=this.params;x(["https://static.getangler.ai/dist/analytics/_latest.min.js"],()=>{window.anglerai.init({workspaceId:t.workspaceId,token:t.tokenPixel}),this.#t()})}logEvent=function(t){let e=this.options;t.data&&e.memberEmail&&(t.data.customer={email:e.memberEmail}),window.anglerai.sendEvent(t)};productViewed(){this.logEvent({eventName:"product_viewed",data:{}})}productSelected(t){let e={cartLine:{merchandise:{id:t.id,price:{id:t.id,amount:t.price},product:{id:t.id}}}};this.logEvent({eventName:"product_added_to_cart",data:e})}pageViewed(){this.logEvent({eventName:"page_viewed",data:{}})}eventSignup(){let t=this.options;if(t.memberEmail&&t.memberId){let e={eventName:"form_submitted",eventId:`signup_${t.memberId}`,data:{customer:{email:t.memberEmail}}};window.anglerai.sendEvent(e)}}eventSignin(){this.logEvent({eventName:"custom_event",data:{},customEventName:"signed_in"})}#t(){this.options.post&&this.pageViewed();let o=new URLSearchParams(document.location.search).get("action"),s=window.location.pathname;o?o==="signin"?this.eventSignin():o==="signup"&&this.eventSignup():s==="/membership/"&&this.productViewed()}},mt=Q;var X=class extends _{#t="algolia-search-popup";#e=!1;#s(){let t=this.params,e=algoliasearch(t.applicationId,t.searchApiKey),o=instantsearch({indexName:t.indexName,searchClient:e});o.addWidgets([instantsearch.widgets.searchBox({container:"#outpost-algolia-search-box"}),instantsearch.widgets.hits({container:"#outpost-algolia-hits",transformItems(s){return s.map(a=>({...a,tag:a.tags.length?a.tags[0].name:null,author:a.authors.length?a.authors[0].name:null}))},templates:{item:(s,{html:a,components:i})=>a`<article class="algolia-hit">
                                <div style="display: flex; flex-direction: row; gap: 1em;">
                                    <div style="max-width: 90px;">
                                        <a href="${s.url}">
                                            <img src="${s.image}" alt="${s.name}" />
                                        </a>
                                    </div>
                                    <div>
                                        <h1 style="font-size: 20px; margin-bottom: 5px;">
                                            <a href="${s.url}">
                                                ${i.Highlight({attribute:"title",highlightedTagName:"mark",hit:s})}
                                            </a>
                                        </h1>
                                        <div>
                                            By <strong>${s.author}</strong> in <strong>${s.tag}</strong>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    ${i.Snippet({attribute:"excerpt",highlightedTagName:"mark",hit:s})}
                                </div>
                            </article>`}}),instantsearch.widgets.clearRefinements({container:"#algolia-clear-refinements"}),instantsearch.widgets.pagination({container:document.querySelector("#outpost-algolia-pagination")}),instantsearch.widgets.refinementList({container:"#outpost-algolia-filter-list",attribute:"tags.name"})]),o.start()}#o(){let t=this.params;document.querySelectorAll(t.displaySelector||"[data-ghost-search]").forEach(s=>{s.replaceWith(s.cloneNode(!0))}),document.querySelectorAll(t.displaySelector||"[data-ghost-search]").forEach(s=>{s.setAttribute("outpost-algolia-search",!0),s.onclick=()=>{s.getAttribute("outpost-algolia-init")||(this.#s(),s.setAttribute("outpost-algolia-init",!0)),this.show()}})}init(){this.#o()}show(){b.show(this.#t,{})}},ht=X;var Z=class{constructor(t){let e={};this.options=t&&typeof t=="object"?this.#t(e,t):e,this.integrations={}}#t(t,e){return Object.keys(e).forEach(o=>{e.hasOwnProperty(o)&&(t[o]=e[o])}),t}#e(t,e){Object.keys(t).forEach(o=>{let s=t[o],a=null;o==="anglerai"?a=new mt(this.options,s.params):o==="algolia"&&(a=new ht(this.options,s.params,e)),a&&(s.jsUrls&&x(s.jsUrls),s.cssUrls&&tt(s.cssUrls),s.css&&w(o+"-css",s.css),s.body&&T(s.body),a.init(),this.integrations[o]=a)})}init(){new y(this.options).request("",{},e=>{if(new pt(this.options,e.site).render(),e.site.integrations&&this.#e(e.site.integrations,e.site.site),e.site.member){let s=new CustomEvent("outpost.memberLoaded",{detail:e.site.member,bubbles:!0,cancelable:!0});dispatchEvent(s)}})}logEvent(t,e){Object.keys(this.integrations).forEach(o=>{let s=this.integrations[o];typeof s[t]=="function"&&s[t](e)})}},ft=Z;var gt=new ft(OutpostPub!==void 0?OutpostPub:{});gt.init();window.OutpostPubJs=gt;})();
//# sourceMappingURL=outpost-pub.js.map
